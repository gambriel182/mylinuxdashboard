{% extends "base.html" %}

{% block title %}Dashboard - Linux Rice Dashboard{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- Meu wallpaper -->
    <div class="card setup-card">
        <div class="card-header">
            <h2><span class="icon">ğŸ–¼ï¸</span> Meu wallpaper</h2>
        </div>
        <div class="card-body">
            <div class="setup-image">
                <img src="/wall.jpg" alt="Meu Linux" loading="lazy">
                <div class="image-overlay">
                    <span class="overlay-text">Meu Rice Linux </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Notas RÃ¡pidas -->
    <div class="card notes-card">
        <div class="card-header">
            <h2><span class="icon">ğŸ“</span> Notas RÃ¡pidas</h2>
            <a href="{{ url_for('notes') }}" class="view-all">Ver Todas â†’</a>
        </div>
        <div class="card-body">
            {% if notes %}
                <div class="notes-list">
                    {% for note in notes %}
                    <div class="note-item {% if note.completed %}completed{% endif %}">
                        <div class="note-title">
                            {% if note.completed %}<s>{{ note.title }}</s>{% else %}{{ note.title }}{% endif %}
                        </div>
                        <div class="note-preview">
                            {{ note.content[:100] }}{% if note.content|length > 100 %}...{% endif %}
                        </div>
                        <div class="note-meta">
                            <span class="note-date">{{ note.created_at.strftime('%d/%m %H:%M') }}</span>
                            {% if note.completed %}
                                <span class="completed-badge">âœ“ ConcluÃ­da</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Sem notas ainda. <a href="{{ url_for('notes') }}">Criar primeira nota</a></p>
                </div>
            {% endif %}
            <div class="card-actions">
                <a href="{{ url_for('notes') }}" class="btn btn-primary">+ Nova Nota</a>
            </div>
        </div>
    </div>

    <!-- Linux Rice News -->
    <div class="card news-card">
        <div class="card-header">
            <h2><span class="icon">ğŸ“°</span> Linux Rice News</h2>
            <button class="refresh-btn" onclick="location.reload()">ğŸ”„</button>
        </div>
        <div class="card-body">
            {% if news %}
                <div class="news-list">
                    {% for item in news %}
                    <div class="news-item">
                        <div class="news-source">{{ item.source }}</div>
                        <h3 class="news-title">
                            <a href="{{ item.link }}" target="_blank" rel="noopener noreferrer">
                                {{ item.title }}
                            </a>
                        </h3>
                        <p class="news-summary">{{ item.summary }}</p>
                        <div class="news-meta">
                            <span class="news-date">{{ item.published }}</span>
                            <a href="{{ item.link }}" target="_blank" class="read-more">Ler Mais â†’</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>A carregar notÃ­cias...</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Links RÃ¡pidos -->
    <div class="card links-card">
        <div class="card-header">
            <h2><span class="icon">ğŸ”—</span> Links RÃ¡pidos</h2>
            <a href="{{ url_for('links') }}" class="view-all">Gerir Links â†’</a>
        </div>
        <div class="card-body">
            {% if links %}
                <div class="links-grid">
                    {% for link in links %}
                    <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="link-item">
                        <div class="link-favicon">
                            <img src="{{ link.favicon }}" alt="Favicon" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="fallback-icon">ğŸ”—</div>
                        </div>
                        <div class="link-info">
                            <div class="link-category">{{ link.category }}</div>
                            <div class="link-title">{{ link.title }}</div>
                            {% if link.description %}
                            <div class="link-description">{{ link.description }}</div>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>Sem links de Fast Access. <a href="{{ url_for('links') }}">Adicionar links e marcar "Fast Access"</a></p>
                </div>
            {% endif %}
            <div class="card-actions">
                <a href="{{ url_for('links') }}" class="btn btn-secondary">+ Adicionar Link</a>
            </div>
        </div>
    </div>

    <!-- Status do Sistema -->
    <div class="card status-card">
        <div class="card-header">
            <h2><span class="icon">ğŸ“Š</span> Status do Sistema</h2>
        </div>
        <div class="card-body">
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">Database:</span>
                    <span class="status-value">ğŸŸ¢ SQLite Online</span>
                </div>
                <div class="status-item">
                    <span class="status-label">RSS Feeds:</span>
                    <span class="status-value">ğŸŸ¢ {{ news|length }} Active</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Notas:</span>
                    <span class="status-value">ğŸ“ {{ notes|length }} Total</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Links:</span>
                    <span class="status-value">ğŸ”— {{ links|length }} Saved</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Uptime:</span>
                    <span class="status-value" id="uptime">Calculando...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Session:</span>
                    <span class="status-value">ğŸ‘¤ {{ session.username }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Uptime counter
    function updateUptime() {
        const startTime = Date.now();
        setInterval(() => {
            const elapsed = Date.now() - startTime;
            const seconds = Math.floor(elapsed / 1000) % 60;
            const minutes = Math.floor(elapsed / 60000) % 60;
            const hours = Math.floor(elapsed / 3600000);
            
            const uptimeStr = `${hours}h ${minutes}m ${seconds}s`;
            const uptimeElement = document.getElementById('uptime');
            if (uptimeElement) {
                uptimeElement.textContent = uptimeStr;
            }
        }, 1000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        updateUptime();
    });
</script>
{% endblock %}
